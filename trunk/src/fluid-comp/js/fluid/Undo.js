fluid=fluid||{};(function($,fluid){var STATE_INITIAL="state_initial",STATE_CHANGED="state_changed",STATE_REVERTED="state_reverted";function defaultRenderer(that,targetContainer){var markup="<span class='fluid-undo'><span class='undoContainer'>[<a href='#' class='undoControl'>undo</a>]</span><span class='redoContainer'>[<a href='#' class='redoControl'>redo</a>]</span></span>";var markupNode=$(markup);targetContainer.append(markupNode);return markupNode}function render(that){if(that.state===STATE_INITIAL){that.locate("undoContainer").hide();that.locate("redoContainer").hide()}else{if(that.state===STATE_CHANGED){that.locate("undoContainer").show();that.locate("redoContainer").hide()}else{if(that.state===STATE_REVERTED){that.locate("undoContainer").hide();that.locate("redoContainer").show()}}}}function bindHandlers(that){that.component.modelFirer.addListener(function(){that.state=STATE_CHANGED;render(that)});that.locate("undoControl").click(function(){fluid.model.copyModel(that.extremalModel,that.component.model);fluid.model.copyModel(that.component.model,that.initialModel);that.component.render();that.state=STATE_REVERTED;render(that)});that.locate("redoControl").click(function(){fluid.model.copyModel(that.component.model,that.extremalModel);that.component.render();that.state=STATE_CHANGED;render(that)})}fluid.undoDecorator=function(component,userOptions){var that=fluid.initView("undo",null,userOptions);that.container=that.options.renderer(that,component.container);fluid.initDomBinder(that);that.component=component;that.initialModel={};that.extremalModel={};fluid.model.copyModel(that.initialModel,component.model);that.state=STATE_INITIAL;render(that);bindHandlers(that);return that};fluid.defaults("undo",{selectors:{undoContainer:".undoContainer",undoControl:".undoControl",redoContainer:".redoContainer",redoControl:".redoControl"},renderer:defaultRenderer})})(jQuery,fluid);
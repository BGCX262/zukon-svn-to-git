fluid=fluid||{};(function(jQuery,fluid){var deriveLightboxCellBase,addThumbnailActivateHandler,createItemFinder,defaultOrderChangedCallback;deriveLightboxCellBase=function(namebase,index){return namebase+"lightbox-cell:"+index+":"};addThumbnailActivateHandler=function(lightboxContainer){var enterKeyHandler=function(evt){if(evt.which===fluid.keys.ENTER){var thumbnailAnchors=jQuery("a",evt.target);document.location=thumbnailAnchors.attr("href")}};jQuery(lightboxContainer).keypress(enterKeyHandler)};createItemFinder=function(parentNode,containerId){var lightboxCellNamePattern="^"+deriveLightboxCellBase(containerId,"[0-9]+")+"$";return function(){return fluid.utils.seekNodesById(parentNode,"div",lightboxCellNamePattern)}};defaultOrderChangedCallback=function(lightboxContainer){var reorderform=fluid.utils.findForm(lightboxContainer);return function(){var inputs,i;inputs=fluid.utils.seekNodesById(reorderform,"input","^"+deriveLightboxCellBase(lightboxContainer.id,"[^:]*")+"reorder-index$");for(i=0;i<inputs.length;i+=1){inputs[i].value=i}if(reorderform&&reorderform.action){jQuery.post(reorderform.action,jQuery(reorderform).serialize(),function(type,data,evt){})}}};fluid.lightbox=function(container,options){var containerEl,orderChangedFn,itemFinderFn,reordererOptions;options=options||{};container=fluid.container(container);jQuery("a",container).tabindex(-1);addThumbnailActivateHandler(container);containerEl=fluid.unwrap(container);orderChangedFn=options.orderChangedCallback||defaultOrderChangedCallback(containerEl);itemFinderFn=(options.selectors&&options.selectors.movables)||createItemFinder(containerEl,containerEl.id);reordererOptions={layoutHandlerName:"fluid.gridLayoutHandler",containerRole:fluid.roles.GRID,orderChangedCallback:orderChangedFn,selectors:{movables:itemFinderFn}};jQuery.extend(true,reordererOptions,options);return fluid.reorderer(container,reordererOptions)}})(jQuery,fluid);
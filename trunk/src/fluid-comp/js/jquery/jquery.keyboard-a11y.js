(function($){var normalizeTabindexName=function(){return $.browser.msie?"tabIndex":"tabindex"};var canHaveDefaultTabindex=function(elements){if(elements.length<=0){return false}return jQuery(elements[0]).is("a, input, button, select, area, textarea, object")};var getValue=function(elements){if(elements.length<=0){return undefined}if(!elements.hasTabindexAttr()){return canHaveDefaultTabindex(elements)?Number(0):undefined}var value=elements.attr(normalizeTabindexName());return Number(value)};var setValue=function(elements,toIndex){return elements.each(function(i,item){$(item).attr(normalizeTabindexName(),toIndex)})};$.fn.tabindex=function(toIndex){if(toIndex!==null&&toIndex!==undefined){return setValue(this,toIndex)}else{return getValue(this)}};$.fn.removeTabindex=function(){return this.each(function(i,item){$(item).removeAttr(normalizeTabindexName())})};$.fn.hasTabindexAttr=function(){if(this.length<=0){return false}var attributeNode=this[0].getAttributeNode(normalizeTabindexName());return attributeNode?attributeNode.specified:false};$.fn.hasTabindex=function(){return this.hasTabindexAttr()||canHaveDefaultTabindex(this)}})(jQuery);(function($){$.a11y=$.a11y||{};$.a11y.keys={UP:38,DOWN:40,LEFT:37,RIGHT:39,SPACE:32,ENTER:13,DELETE:46,TAB:9,CTRL:17,SHIFT:16,ALT:18};$.a11y.orientation={HORIZONTAL:0,VERTICAL:1,BOTH:2};var NAMESPACE_KEY="keyboard-a11y";var CONTEXT_KEY="selectionContext";var HANDLERS_KEY="userHandlers";var ACTIVATE_KEY="defaultActivate";var NO_SELECTION=-32768;var UP_DOWN_KEYMAP={next:$.a11y.keys.DOWN,previous:$.a11y.keys.UP};var LEFT_RIGHT_KEYMAP={next:$.a11y.keys.RIGHT,previous:$.a11y.keys.LEFT};var unwrap=function(element){return element.jquery?element[0]:element};var cleanUpWhenLeavingContainer=function(selectionContext){if(selectionContext.onLeaveContainer){selectionContext.onLeaveContainer(selectionContext.selectables[selectionContext.activeItemIndex])}else{if(selectionContext.onUnselect){selectionContext.onUnselect(selectionContext.selectables[selectionContext.activeItemIndex])}}if(!selectionContext.options.rememberSelectionState){selectionContext.activeItemIndex=NO_SELECTION}};var checkForModifier=function(binding,evt){if(!binding.modifier){return true}var modifierKey=binding.modifier;var isCtrlKeyPresent=(modifierKey&&evt.ctrlKey);var isAltKeyPresent=(modifierKey&&evt.altKey);var isShiftKeyPresent=(modifierKey&&evt.shiftKey);return(isCtrlKeyPresent||isAltKeyPresent||isShiftKeyPresent)};var activationHandler=function(binding){return function(evt){var code=(evt.which?evt.which:evt.keyCode);if(code===binding.key&&binding.activateHandler&&checkForModifier(binding,evt)){binding.activateHandler(evt.target,evt);evt.preventDefault()}}};var drawSelection=function(elementToSelect,handler){if(handler){handler(elementToSelect)}};var eraseSelection=function(selectedElement,handler){if(handler&&selectedElement){handler(selectedElement)}};var unselectElement=function(selectedElement,selectionContext){eraseSelection(selectedElement,selectionContext.options.onUnselect)};var selectElement=function(elementToSelect,selectionContext){unselectElement(selectionContext.selectedElement(),selectionContext);elementToSelect=unwrap(elementToSelect);var newIndex=selectionContext.selectables.index(elementToSelect);if(newIndex===-1){return }selectionContext.activeItemIndex=newIndex;drawSelection(elementToSelect,selectionContext.options.onSelect)};var selectableFocusHandler=function(selectionContext){return function(evt){selectElement(evt.target,selectionContext);return evt.stopPropagation()}};var selectableBlurHandler=function(selectionContext){return function(evt){unselectElement(evt.target,selectionContext);return evt.stopPropagation()}};var reifyIndex=function(sc_that){var elements=sc_that.selectables;if(sc_that.activeItemIndex>=elements.length){sc_that.activeItemIndex=0}if(sc_that.activeItemIndex<0&&sc_that.activeItemIndex!==NO_SELECTION){sc_that.activeItemIndex=elements.length-1}if(sc_that.activeItemIndex>=0){$(elements[sc_that.activeItemIndex]).focus()}};var prepareShift=function(selectionContext){unselectElement(selectionContext.selectedElement(),selectionContext);if(selectionContext.activeItemIndex===NO_SELECTION){selectionContext.activeItemIndex=-1}};var focusNextElement=function(selectionContext){prepareShift(selectionContext);++selectionContext.activeItemIndex;reifyIndex(selectionContext)};var focusPreviousElement=function(selectionContext){prepareShift(selectionContext);--selectionContext.activeItemIndex;reifyIndex(selectionContext)};var arrowKeyHandler=function(selectionContext,keyMap,userHandlers){return function(evt){if(evt.which===keyMap.next){focusNextElement(selectionContext);evt.preventDefault()}else{if(evt.which===keyMap.previous){focusPreviousElement(selectionContext);evt.preventDefault()}}}};var getKeyMapForDirection=function(direction){var keyMap;if(direction===$.a11y.orientation.HORIZONTAL){keyMap=LEFT_RIGHT_KEYMAP}else{keyMap=UP_DOWN_KEYMAP}return keyMap};var containerFocusHandler=function(selectionContext){return function(evt){var shouldOrig=selectionContext.options.autoSelectFirstItem;var shouldSelect=typeof (shouldOrig)==="function"?shouldOrig():shouldOrig;if(selectionContext.focusIsLeavingContainer){shouldSelect=false}if(shouldSelect&&evt.target===selectionContext.container.get(0)){if(selectionContext.activeItemIndex===NO_SELECTION){selectionContext.activeItemIndex=0}$(selectionContext.selectables[selectionContext.activeItemIndex]).focus()}return evt.stopPropagation()}};var containerBlurHandler=function(selectionContext){return function(evt){selectionContext.focusIsLeavingContainer=false;return evt.stopPropagation()}};var makeElementsTabFocussable=function(elements){elements.each(function(idx,item){item=$(item);if(!item.hasTabindex()||(item.tabindex()<0)){item.tabindex(0)}})};var makeElementsActivatable=function(elements,onActivateHandler,defaultKeys,options){var bindings=[];$(defaultKeys).each(function(index,key){bindings.push({modifier:null,key:key,activateHandler:onActivateHandler})});if(options&&options.additionalBindings){bindings=bindings.concat(options.additionalBindings)}for(var i=0;i<bindings.length;i=i+1){var binding=bindings[i];elements.keydown(activationHandler(binding))}};var tabKeyHandler=function(selectionContext){return function(evt){if(evt.which!==$.a11y.keys.TAB){return }cleanUpWhenLeavingContainer(selectionContext);if(evt.shiftKey){selectionContext.focusIsLeavingContainer=true}}};var makeElementsSelectable=function(container,defaults,userOptions){var options=$.extend(true,{},defaults,userOptions);var keyMap=getKeyMapForDirection(options.direction);var selectableElements=options.selectableElements?options.selectableElements:container.find(options.selectableSelector);var that={container:container,activeItemIndex:NO_SELECTION,selectables:selectableElements,focusIsLeavingContainer:false,options:options};that.selectablesUpdated=function(){that.selectables.tabindex(-1);that.selectables.unbind("focus."+NAMESPACE_KEY);that.selectables.unbind("blur."+NAMESPACE_KEY);that.selectables.bind("focus."+NAMESPACE_KEY,selectableFocusHandler(that));that.selectables.bind("blur."+NAMESPACE_KEY,selectableBlurHandler(that));reifyIndex(that)};that.refresh=function(){if(!that.options.selectableSelector){throw ("Cannot refresh selectable context which was not initialised by a selector")}that.selectables=container.find(options.selectableSelector);that.selectablesUpdated()};that.selectedElement=function(){return that.activeItemIndex<0?null:that.selectables[that.activeItemIndex]};container.keydown(arrowKeyHandler(that,keyMap));container.keydown(tabKeyHandler(that));container.focus(containerFocusHandler(that));container.blur(containerBlurHandler(that));that.selectablesUpdated();return that};var createDefaultActivationHandler=function(activatables,userActivateHandler){return function(elementToActivate){if(!userActivateHandler){return }elementToActivate=unwrap(elementToActivate);if(activatables.index(elementToActivate)===-1){return }userActivateHandler(elementToActivate)}};var getData=function(aJQuery,key){var data=aJQuery.data(NAMESPACE_KEY);return data?data[key]:undefined};var setData=function(aJQuery,key,value){var data=aJQuery.data(NAMESPACE_KEY)||{};data[key]=value;aJQuery.data(NAMESPACE_KEY,data)};$.fn.tabbable=function(){makeElementsTabFocussable(this);return this};$.fn.selectable=function(options){var that=makeElementsSelectable(this,this.selectable.defaults,options);setData(this,CONTEXT_KEY,that);return this};$.fn.getSelectableContext=function(){return getData(this,CONTEXT_KEY)};$.fn.activatable=function(fn,options){makeElementsActivatable(this,fn,this.activatable.defaults.keys,options);setData(this,ACTIVATE_KEY,createDefaultActivationHandler(this,fn));return this};$.fn.select=function(elementToSelect){elementToSelect.focus();return this};$.fn.selectNext=function(){focusNextElement(getData(this,CONTEXT_KEY));return this};$.fn.selectPrevious=function(){focusPreviousElement(getData(this,CONTEXT_KEY));return this};$.fn.currentSelection=function(){var that=getData(this,CONTEXT_KEY);return $(that.selectedElement())};$.fn.activate=function(elementToActivate){var handler=getData(this,ACTIVATE_KEY);handler(elementToActivate);return this};$.fn.activatable.defaults={keys:[$.a11y.keys.ENTER,$.a11y.keys.SPACE]};$.fn.selectable.defaults={direction:this.VERTICAL,autoSelectFirstItem:true,rememberSelectionState:true,selectableSelector:".selectable",selectableElements:null,onSelect:null,onUnselect:null,onLeaveContainer:null}})(jQuery);